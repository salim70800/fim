import{d as C,e as L,r as i,j as e,L as n}from"./react-core-Cfr18xtl.js";import{s as x}from"./supabase-BWlcyJjF.js";import{D as q}from"./DynamicSEO-BuC0_snW.js";import{V as P}from"./VideoPlayer-pE8VtgNi.js";import{f as A,C as m,L as w,c as I,b as R,a as T}from"./lucide-Dk-NOH9t.js";import"./vendor-CKCmSFOu.js";import"./supabase-Mw2DHMHY.js";function J(){const{id:o}=C(),u=L(),[a,y]=i.useState(null),[s,_]=i.useState(null),[j,E]=i.useState([]),[r,$]=i.useState([]),[D,g]=i.useState(!0);if(i.useEffect(()=>{(async()=>{if(o)try{g(!0);const{data:c,error:f}=await x.from("episodes").select("*").eq("id",o).single();if(f)throw f;_(c);const{data:k,error:N}=await x.from("content").select("*").eq("id",c.content_id).single();if(N)throw N;y(k);const{data:b}=await x.from("servers").select("*").eq("episode_id",o).eq("is_active",!0).order("priority",{ascending:!0});b&&E(b);const{data:v}=await x.from("episodes").select("*").eq("content_id",c.content_id).eq("status","published").order("season_number",{ascending:!0}).order("episode_number",{ascending:!0});v&&$(v)}catch(c){console.error("Error fetching episode:",c)}finally{g(!1)}})()},[o]),D)return e.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-orange-500 mx-auto mb-4"}),e.jsx("p",{className:"text-neutral-400",children:"جاري التحميل..."})]})});if(!a||!s)return e.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-neutral-400 text-lg mb-4",children:"الحلقة غير موجودة"}),e.jsx(n,{to:"/",className:"text-orange-500 hover:text-orange-400",children:"العودة إلى الرئيسية"})]})});const d=r.findIndex(t=>t.id===s.id),h=d>0?r[d-1]:null,p=d<r.length-1?r[d+1]:null,l=a.type==="anime"?"anime":"series",S=a.type==="anime"?"أنمي":"مسلسل";return e.jsxs(e.Fragment,{children:[e.jsx(q,{content:a,episode:s,type:"episode"}),e.jsxs("div",{className:"min-h-screen bg-black",children:[e.jsx("div",{className:"bg-neutral-900 border-b border-neutral-800",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-neutral-400",children:[e.jsx(n,{to:"/",className:"hover:text-orange-500 transition-colors",children:e.jsx(A,{className:"w-4 h-4"})}),e.jsx(m,{className:"w-4 h-4"}),e.jsx(n,{to:`/${l}s`,className:"hover:text-orange-500 transition-colors",children:l==="anime"?"الأنمي":"المسلسلات"}),e.jsx(m,{className:"w-4 h-4"}),e.jsx(n,{to:`/${l}/${a.id}`,className:"hover:text-orange-500 transition-colors",children:a.title_ar}),e.jsx(m,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-white",children:["الحلقة ",s.episode_number]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-white mb-2",children:s.title_ar}),s.title_en&&e.jsx("p",{className:"text-xl text-neutral-400",children:s.title_en}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mt-4 text-neutral-400",children:[s.season_number&&e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(w,{className:"w-4 h-4"}),"الموسم ",s.season_number]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:["الحلقة ",s.episode_number]}),s.duration&&e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(I,{className:"w-4 h-4"}),s.duration," دقيقة"]}),s.air_date&&e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(R,{className:"w-4 h-4"}),new Date(s.air_date).toLocaleDateString("ar-EG")]})]})]}),j.length>0?e.jsx(P,{servers:j,title:`${a.title_ar} - ${s.title_ar}`,autoPlay:!0}):e.jsx("div",{className:"w-full aspect-video bg-neutral-900 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-neutral-400 mb-2",children:"لا توجد سيرفرات متاحة لهذه الحلقة"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"يرجى المحاولة لاحقاً"})]})}),s.description&&e.jsxs("div",{className:"bg-neutral-900 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-3",children:"نبذة عن الحلقة"}),e.jsx("p",{className:"text-neutral-300 leading-relaxed",children:s.description})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[h?e.jsx("button",{onClick:()=>u(`/episode/${h.id}`),className:"flex-1 bg-neutral-900 hover:bg-neutral-800 rounded-lg p-4 transition-colors text-right",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(T,{className:"w-5 h-5 text-orange-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-neutral-400 mb-1",children:"الحلقة السابقة"}),e.jsxs("p",{className:"text-white font-semibold",children:["الحلقة ",h.episode_number]})]})]})}):e.jsx("div",{className:"flex-1"}),e.jsxs(n,{to:`/${l}/${a.id}`,className:"px-6 py-4 bg-orange-500 hover:bg-orange-600 rounded-lg font-semibold text-white transition-colors flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5"}),e.jsx("span",{children:"جميع الحلقات"})]}),p?e.jsx("button",{onClick:()=>u(`/episode/${p.id}`),className:"flex-1 bg-neutral-900 hover:bg-neutral-800 rounded-lg p-4 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-neutral-400 mb-1",children:"الحلقة التالية"}),e.jsxs("p",{className:"text-white font-semibold",children:["الحلقة ",p.episode_number]})]}),e.jsx(m,{className:"w-5 h-5 text-orange-500"})]})}):e.jsx("div",{className:"flex-1"})]}),r.length>0&&e.jsxs("div",{className:"bg-neutral-900 rounded-lg p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"جميع الحلقات"}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-3",children:r.map(t=>e.jsx(n,{to:`/episode/${t.id}`,className:`
                      p-4 rounded-lg transition-all
                      ${t.id===s.id?"bg-orange-500 text-white":"bg-neutral-800 text-neutral-300 hover:bg-neutral-700"}
                    `,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold",children:["الحلقة ",t.episode_number]}),e.jsx("p",{className:"text-sm opacity-75 line-clamp-1",children:t.title_ar})]}),t.duration&&e.jsxs("span",{className:"text-sm opacity-75",children:[t.duration," د"]})]})},t.id))})]}),e.jsx("div",{className:"text-center",children:e.jsxs(n,{to:`/${l}/${a.id}`,className:"inline-block px-6 py-3 bg-neutral-900 hover:bg-neutral-800 rounded-lg text-white font-semibold transition-colors",children:["العودة إلى صفحة ",S]})})]})]})]})}export{J as default};
