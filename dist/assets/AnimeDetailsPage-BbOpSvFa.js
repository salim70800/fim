import{d as C,r as l,j as e,L as u}from"./react-core-Cfr18xtl.js";import{s as g}from"./supabase-BWlcyJjF.js";import{D as L}from"./DynamicSEO-BuC0_snW.js";import{S as P}from"./StructuredData-3nAFOEiM.js";import{C as U}from"./ContentCard-Dvg_uoT_.js";import{F as _,b as $,d as F,G,P as y,H,e as I,c as T,U as O,T as R}from"./lucide-Dk-NOH9t.js";import"./vendor-CKCmSFOu.js";import"./supabase-Mw2DHMHY.js";function X(){const{id:n}=C(),[t,S]=l.useState(null),[p,k]=l.useState([]),[a,D]=l.useState([]),[b,E]=l.useState([]),[f,j]=l.useState(1),[A,N]=l.useState(!0);if(l.useEffect(()=>{(async()=>{if(n)try{N(!0);const{data:r,error:v}=await g.from("content").select("*").eq("id",n).eq("type","anime").single();if(v)throw v;S(r);const{data:i}=await g.from("content_genres").select("genre_id, genres(*)").eq("content_id",n);if(i){const x=[];i.forEach(d=>{d.genres&&x.push(d.genres)}),k(x)}const{data:c}=await g.from("episodes").select("*").eq("content_id",n).eq("status","published").order("season_number",{ascending:!0}).order("episode_number",{ascending:!0});if(c&&(D(c),c.length>0&&c[0].season_number&&j(c[0].season_number)),i&&i.length>0){const x=i.map(h=>h.genre_id),{data:d}=await g.from("content_genres").select("content_id, content(*)").in("genre_id",x).neq("content_id",n).limit(8);if(d){const h=[],w=new Set;d.forEach(o=>{o.content&&o.content.type==="anime"&&!w.has(o.content.id)&&(h.push(o.content),w.add(o.content.id))}),E(h.slice(0,6))}}}catch(r){console.error("Error fetching anime:",r)}finally{N(!1)}})()},[n]),A)return e.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-orange-500 mx-auto mb-4"}),e.jsx("p",{className:"text-neutral-400",children:"جاري التحميل..."})]})});if(!t)return e.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(_,{className:"w-16 h-16 text-neutral-600 mx-auto mb-4"}),e.jsx("p",{className:"text-neutral-400 text-lg",children:"الأنمي غير موجود"}),e.jsx(u,{to:"/anime",className:"text-orange-500 hover:text-orange-400 mt-4 inline-block",children:"العودة إلى الأنمي"})]})});const m=Array.from(new Set(a.map(s=>s.season_number).filter(s=>s!==null))).sort((s,r)=>(s||0)-(r||0)),q=a.filter(s=>s.season_number===f);return e.jsxs(e.Fragment,{children:[e.jsx(L,{content:t,type:"anime"}),e.jsx(P,{content:t,genres:p,type:"anime",breadcrumbs:[{name:"الرئيسية",url:"/"},{name:"الأنمي",url:"/anime"},{name:t.title_ar,url:`/anime/${t.id}`}]}),e.jsxs("div",{className:"min-h-screen bg-black",children:[e.jsxs("div",{className:"relative h-[60vh] md:h-[70vh]",children:[e.jsxs("div",{className:"absolute inset-0",children:[e.jsx("img",{src:t.banner_url||t.poster_url||"/placeholder.jpg",alt:t.title_ar,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-black/60 to-transparent"})]}),e.jsx("div",{className:"relative h-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-end pb-12",children:e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-6 md:gap-8",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:t.poster_url||"/placeholder.jpg",alt:t.title_ar,className:"w-48 md:w-64 rounded-lg shadow-2xl"})}),e.jsxs("div",{className:"flex-1 text-white",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold mb-2",children:t.title_ar}),t.title_en&&e.jsx("p",{className:"text-xl md:text-2xl text-neutral-300 mb-4",children:t.title_en}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-6 text-sm md:text-base",children:[t.year&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx($,{className:"w-4 h-4"}),e.jsx("span",{children:t.year})]}),t.imdb_rating&&e.jsxs("div",{className:"flex items-center gap-1.5 bg-orange-500/20 px-3 py-1 rounded-full",children:[e.jsx(F,{className:"w-4 h-4 fill-orange-500 text-orange-500"}),e.jsx("span",{className:"font-semibold",children:t.imdb_rating})]}),t.country&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{children:t.country})]}),t.language&&e.jsx("span",{className:"px-3 py-1 bg-neutral-800 rounded-full text-sm",children:t.language}),m.length>0&&e.jsxs("span",{className:"px-3 py-1 bg-orange-500 rounded-full text-sm font-semibold",children:[m.length," مواسم"]}),a.length>0&&e.jsxs("span",{className:"px-3 py-1 bg-neutral-800 rounded-full text-sm",children:[a.length," حلقة"]})]}),p.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-6",children:p.map(s=>e.jsx("span",{className:"px-3 py-1 bg-white/10 backdrop-blur-sm rounded-full text-sm",children:s.name_ar},s.id))}),t.description&&e.jsx("p",{className:"text-neutral-300 text-base md:text-lg leading-relaxed max-w-3xl",children:t.description}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-6",children:[a.length>0&&e.jsxs(u,{to:`/episode/${a[0].id}`,className:"px-6 py-2.5 bg-orange-500 hover:bg-orange-600 rounded-lg font-semibold transition-colors flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5"}),e.jsx("span",{children:"بدء المشاهدة"})]}),e.jsxs("button",{className:"px-6 py-2.5 bg-white/10 hover:bg-white/20 backdrop-blur-sm rounded-lg font-semibold transition-colors flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),e.jsx("span",{children:"إضافة للمفضلة"})]}),e.jsxs("button",{className:"px-6 py-2.5 bg-white/10 hover:bg-white/20 backdrop-blur-sm rounded-lg font-semibold transition-colors flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5"}),e.jsx("span",{children:"مشاركة"})]})]})]})]})})})]}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 space-y-12",children:[a.length>0&&e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"الحلقات"}),m.length>1&&e.jsx("div",{className:"flex gap-2",children:m.map(s=>e.jsxs("button",{onClick:()=>j(s),className:`
                          px-4 py-2 rounded-lg font-semibold transition-all
                          ${f===s?"bg-orange-500 text-white":"bg-neutral-800 text-neutral-300 hover:bg-neutral-700"}
                        `,children:["الموسم ",s]},s))})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:q.map(s=>e.jsxs(u,{to:`/episode/${s.id}`,className:"group bg-neutral-900 rounded-lg overflow-hidden hover:bg-neutral-800 transition-colors",children:[e.jsxs("div",{className:"relative aspect-video",children:[e.jsx("img",{src:s.thumbnail_url||t.banner_url||"/placeholder.jpg",alt:s.title_ar,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/40 group-hover:bg-black/60 transition-colors flex items-center justify-center",children:e.jsx(y,{className:"w-12 h-12 text-white opacity-0 group-hover:opacity-100 transition-opacity"})}),e.jsxs("div",{className:"absolute top-2 right-2 px-2 py-1 bg-black/80 backdrop-blur-sm rounded text-white text-sm font-semibold",children:["الحلقة ",s.episode_number]})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-white font-semibold mb-1 line-clamp-1",children:s.title_ar}),s.description&&e.jsx("p",{className:"text-neutral-400 text-sm line-clamp-2 mb-2",children:s.description}),s.duration&&e.jsxs("div",{className:"flex items-center gap-1.5 text-neutral-500 text-sm",children:[e.jsx(T,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.duration," دقيقة"]})]})]})]},s.id))})]}),e.jsxs("section",{className:"grid md:grid-cols-2 gap-6",children:[t.movie_cast&&e.jsxs("div",{className:"bg-neutral-900 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(O,{className:"w-5 h-5 text-orange-500"}),"طاقم التمثيل"]}),e.jsx("p",{className:"text-neutral-300 leading-relaxed",children:t.movie_cast})]}),t.director&&e.jsxs("div",{className:"bg-neutral-900 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5 text-orange-500"}),"الإخراج"]}),e.jsx("p",{className:"text-neutral-300 leading-relaxed",children:t.director})]})]}),b.length>0&&e.jsxs("section",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-white mb-6 flex items-center gap-2",children:[e.jsx(R,{className:"w-6 h-6 text-orange-500"}),"أنمي مشابه"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:b.map(s=>e.jsx(U,{id:s.id,title:s.title_ar,year:s.year,rating:s.imdb_rating||s.user_rating,posterUrl:s.poster_url,type:s.type,language:s.language},s.id))})]})]})]})]})}export{X as default};
